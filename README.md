# Astra Monitor

Система удаленного мониторинга и управления для компьютеров под управлением ОС Astra Linux и Windows.

## О проекте

Astra Monitor состоит из двух основных частей:
1.  **Сервер (GUI)**: Кроссплатформенное приложение с графическим интерфейсом (написано на PyQt5), которое позволяет в реальном времени отслеживать состояние подключенных клиентов, управлять ими и выполнять различные команды.
2.  **Клиент**: Легковесное приложение для Astra Linux и Windows, которое работает в фоновом режиме, собирает системную информацию и выполняет команды, полученные от сервера.

## Возможности

### Сервер

*   **Список клиентов**: Отображение подключенных клиентов в виде списка или сетки со скриншотами.
*   **Мониторинг в реальном времени**: Отслеживание загрузки CPU, использования RAM, дискового пространства и сетевой активности.
*   **Детальная информация**: Просмотр подробной информации о "железе" и программном обеспечении клиента.
*   **Файловый менеджер**: Загрузка/скачивание файлов, создание/удаление/переименование файлов и папок на клиенте через контекстное меню.
*   **Удаленный терминал**: Выполнение shell-команд на клиенте.
*   **Просмотр экрана**: Получение скриншотов с рабочего стола клиента с настраиваемым качеством и автообновлением.
*   **Управление обновлениями (APT для Linux)**: Просмотр и редактирование репозиториев, проверка и установка обновлений (только для Linux).
*   **Взаимодействие с пользователем**: Отправка всплывающих сообщений на рабочий стол клиента.
*   **Управление питанием**: Удаленная перезагрузка и выключение клиентских машин.
*   **Самообновление клиентов (только Linux)**: Возможность централизованно обновить клиентское ПО, отправив новый `.deb` пакет.
*   **Интеграция с системой**: Сворачивание в системный трей.

### Клиент

*   **Кросс-платформенность**: Работает на Astra Linux и Windows.
*   **Фоновая работа**: 
    *   На Linux запускается как служба `systemd` и автоматически стартует при загрузке системы.
    *   На Windows запускается как скрытое приложение без окна, предназначенное для добавления в автозагрузку.
*   **Сбор метрик**: Собирает и отправляет на сервер данные о производительности системы, используя нативные инструменты ОС или `psutil`.
*   **Исполнение команд**: Безопасно выполняет команды, полученные от сервера.
*   **Файловые операции**: Обрабатывает запросы на скачивание/загрузку и управление файлами.
*   **Создание скриншотов**: Делает снимки рабочего стола по запросу.
*   **Гибкая конфигурация**: Параметры подключения к серверу "вшиваются" при сборке. Дополнительные настройки можно переопределить через локальный файл.

---

## Установка

### Установка Сервера

Сервер представляет собой один исполняемый файл, который можно запустить на Linux или Windows.

1.  Соберите сервер из исходного кода с помощью скрипта `build_server.py`.
2.  Найдите исполняемый файл `astra-monitor-server` (для Linux) или `astra-monitor-server.exe` (для Windows) в папке `dist/`.
3.  Запустите файл.

### Установка Клиента

1.  Соберите клиентский файл с помощью `build_client.py`, **обязательно** указав данные для подключения к серверу.
2.  В зависимости от ОС:
    *   **Для Linux**: 
        *   В конце сборки согласитесь на создание `.deb` пакета.
        *   Скопируйте полученный файл `astra-monitor-client_..._amd64.deb` на целевую машину.
        *   Выполните команду: `sudo dpkg -i astra-monitor-client_X.Y.Z_amd64.deb`
        *   Служба `astra-monitor.service` будет установлена и запущена автоматически.
    *   **Для Windows**:
        *   Найдите файл `astra-monitor-client.exe` в папке `dist/`.
        *   Для автоматического запуска при входе в систему, поместите ярлык этого файла в папку автозагрузки. Для этого:
            1. Нажмите `Win + R`.
            2. Введите `shell:startup` и нажмите Enter.
            3. Скопируйте `astra-monitor-client.exe` или создайте на него ярлык в открывшейся папке.

---

## Сборка из исходного кода

### 1. Подготовка окружения

Для сборки на Windows вам понадобится Python 3.11+.

```bash
# Клонируем репозиторий
git clone https://github.com/gr4shin/astra-monitor
cd astra-monitor

# Создаем и активируем виртуальное окружение
python3 -m venv .venv
.venv\Scripts\activate

# Устанавливаем зависимости
pip install -r requirements.txt
```


Для сборки на Astra Linux вам понадобится Python 3.11+.
```bash
# Клонируем репозиторий
git clone https://github.com/gr4shin/astra-monitor
cd astra-monitor

# Устанавливаем Python 3.11 и системные зависимости (для Debian/Astra/Ubuntu)
sudo apt update
sudo apt install python3.11 python3.11-venv python3.11-dev python3.11-tk build-essential dpkg-deb

# Устанавливаем/обновляем pip для Python 3.11
curl -sS https://bootstrap.pypa.io/get-pip.py | python3.11

# Создаем и активируем виртуальное окружение
python3.11 -m venv venv
source venv/bin/activate

# Зависимости Python
python3.11 -m pip install -r requirements.txt
```

### 2. Сборка Сервера

Скрипт `build_server.py` соберет исполняемый файл сервера для вашей текущей ОС.

```bash
python build_server.py
```

В процессе сборки скрипт запросит у вас IP-адрес, порт и токен аутентификации для встраивания в сервер.

### 3. Сборка Клиента

Скрипт `build_client.py` соберет исполняемый файл клиента для вашей текущей ОС.

```bash
python build_client.py
```

Скрипт последовательно выполнит следующие шаги:
1.  **Установит необходимые зависимости** для текущей платформы (`pywin32`, `WMI` только для Windows).
2.  **Запросит конфигурацию (обязательно)**: IP-адрес сервера, порт и токен. Эти данные будут зашифрованы и встроены в исполняемый файл.
3.  **Соберет исполняемый файл** в папку `dist/`.
    *   Для Windows будет создан файл `astra-monitor-client.exe` без консольного окна (`--windowed`).
    *   Для Linux будет создан консольный файл `astra-monitor-client`.
4.  **Выведет инструкции** по установке и запуску для вашей ОС.

---

## Конфигурация

### Конфигурация Клиента

Параметры для подключения клиента к серверу (`server_host`, `server_port`, `auth_token`) задаются **исключительно на этапе сборки**.

Дополнительные (некритичные) настройки можно переопределить на клиентской машине, создав файл конфигурации.
*   **Linux**: `/etc/astra-monitor-client/config.json`
*   **Windows**: `%APPDATA%\AstraMonitorClient\config.json`

**Пример `config.json` для изменения интервалов:**

```json
{
    "monitoring_interval": 10,
    "reconnect_delay": 5,
    "screenshot": {
        "quality": 85,
        "refresh_delay": 5
    }
}
```

После создания или изменения этого файла перезапустите службу:
```bash
sudo systemctl restart astra-monitor.service
```
---

## Ключ обфускации

Для защиты встроенной конфигурации клиента используется простой механизм обфускации (XOR-шифрование). Ключ для этого задается в константе `OBFUSCATION_KEY`.

*   В скрипте сборки: `build_standalone.py`
*   В коде клиента: `client_monitor.py`

**Важно:** Значения `OBFUSCATION_KEY` в обоих файлах должны **строго совпадать**. Для повышения безопасности рекомендуется изменить ключ по умолчанию на свой собственный перед сборкой клиентов.